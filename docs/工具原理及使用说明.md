# 工具原理及使用说明

## 1. 工具原理

基础命令工具集相对于其他C语言项目而言存在的特点是库文件分散，二进制文件众多且依赖关系错综复杂。比如openeular:22.03-lts中使用的coreutils-9.0就在160余个原地C语言文件和GNUlib中的800余个文件的相互依赖下生成了107个二进制文件。人工梳理这些依赖关系显得非常不现实。

针对这个问题，本工具基于Clang解析的语法树的自动分析依赖。该工具首先先利用Bear等工具获取在编译基础命令时所调用的所有编译命令，得到Clang格式的compile_command.json文件。然后基于该文件通过Clang解析编译期间所涉及的所有C语言文件进行语法树解析，对不同文件之间语法树中出现的调用关系进行提取。因为C语言本身并不支持符号声明和定义之间的精确链接（在Rust中并不区分声明和定义），我们在此基础上设计了模糊匹配的依赖构建框架。依赖构建过程中可以将符号的声明和定义根据用户可调节的不同的模糊程度进行匹配，最终构建得到整个项目的依赖关系。

## 2. 工具使用说明

### 2.1 依赖提取工具

依赖提取工具名字为deps-exporter，使用方式基本如下：
deps-exporter [OPTIONS] <COMPILE_COMMANDS> [--] [EXTRA_CLANG_ARGS]...